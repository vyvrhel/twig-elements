{#-
	***************
	HTML 5 Document
	***************

	An extendable HTML skeleton for a full HTML5 document, including <html>, <head>, and <body> elements.
	Supports BEM-based class generation, customizable attributes, and easy insertion of meta, title, scripts, and styles.

	Structure:
	----------
	└── html
		└── body

	HTML attributes:
	----------------
	All attributes of the <html> and <body> tags are assigned via properties of the `doc` object.
	For example, `doc.html_lang`, `doc.body_class`, `doc.html_data_foo`, etc.

	Properties:
	-----------
	└── Document metadata:
	- "title" (string) - Page title, rendered inside <title> tag, accessed as `doc.title`.
	- "charset" (string) - Document charset, default "UTF-8", rendered as `<meta charset="{{ doc.charset }}">`.
	- "body" (string) - Content of the <body> (for a more complex value, define the "doc_body" block {% block doc_body %}...{% endblock %}).

	└── BEM settings:
	- "bem_root" (string) - Base BEM block name for the document wrapper.
	- "bem_root_var" (string) - Shortcut variable name for `bem_root` inside template (default "R").
	- "bem_body_suffix" (string) - Suffix for body BEM class (default "__body").

	└── HTML attribute handling:
	- "html_attrs" and "body_attrs" (via `doc` properties) - Any additional attributes can be passed in the `doc` object.
	- Attribute rendering rules:
		- attr = value → renders `attr="value"`.
		- attr = true → renders `attr`.
		- attr = false|null → not rendered.
		- prefixed with "!" → concatenates instead of overriding.

	Example:
	--------

		Twig:
		-----
		{% extends '_doc.html.twig' %}

		{% set doc = {
			'title': 'My Page',
			'bem_root': 'Page',
			'html_id': 'page',
			'body': '<h1>Welcome</h1><p>Hello world!</p>',
			'body_id': 'page-body',
		}|merge(doc ?? {}) %}

		HTML result:
		------------
		<!DOCTYPE html>
		<html lang="en" class="Page" id="page">
			<head>
				<title>My Page</title>
				<meta charset="UTF-8">
			</head>
			<body class="Page__body" id="page-body">
				<h1>Welcome</h1>
				<p>Hello world!</p>
			</body>
		</html>
-#}

{%- set doc = {
	'title': '',
	'body': '',
	'charset': 'UTF-8',

	'bem_root': null,
	'bem_root_var': 'R',
	'bem_body_suffix': '__body',

	'html_lang': 'en',
}|merge(doc ?? {}) -%}

{#- Wrap -#}
{%- block doc_scope -%}
{%- with { (doc.bem_root_var): doc.bem_root } -%} {#- = Shortcut for "doc.bem_root" -#}

	{#- = BEM classes based on "bem_xxx" properties -#}
	{%- if doc.bem_root -%}
		{%- set doc = doc|merge({
			'html_class': (doc.bem_root ~ ' ' ~ (doc.html_class ?? ''))|trim,
			'body_class': ((doc.bem_root ~ doc.bem_body_suffix) ~ ' ' ~ (doc.body_class ?? ''))|trim,
		}) -%}
	{%- endif -%}

	{#- Doctype -#}
	{%- block doc_type -%}
		<!DOCTYPE html>
	{%- endblock -%}

	{#- Html wrap -#}
	{%- block doc_outer -%}
		<html

			{#- Attributes -#}
			{%- block doc_attrs -%}
				{%- set attr_source = attr_source ?? doc -%}
				{%- set attr_prefix = attr_prefix ?? 'html_' -%}

				{#- = Get and concat "prepend/append" and "normal" HTML attributes -#}
				{%- set attrs = {} -%}
				{%- for attr, val in attr_source|sort -%}
					{%- if
						attr starts with attr_prefix
						and val is not same as(false)
						and val is not same as(null)
					-%}
						{%- set attr = attr[attr_prefix|length:] -%}
						{%- set is_prepend = attr starts with '!' -%}
						{%- set attr = attr|trim('!') -%}
						{%- set attrs = attrs|merge({
							(attr): (val is not iterable and val is not same as(true))
								? ((is_prepend ? val) ~ ' ' ~ (attrs[attr] ?? '') ~ ' ' ~ (not is_prepend ? val))|trim
								: val,
						}) -%}
					{%- endif -%}
				{%- endfor -%}

				{#- Render attributes -#}
				{%- for attr, val in attrs -%}

					{#- Attribute -#}
					{%- block doc_attr -%}
						{{- ' ' ~ attr }}
						{%- if val is not same as(true) -%}
							="

							{#- Attribute value -#}
							{%- block doc_attr_val ('{{' in val ? include(template_from_string(val)) : val)|e('html') -%}

							"
						{%- endif -%}
					{%- endblock -%}

				{%- endfor -%}
			{%- endblock -%}

		>

			{#- Html -#}
			{%- block doc -%}

				{#- Head wrap -#}
				{%- block doc_head_outer -%}
					<head>

						{#- Head -#}
						{%- block doc_head -%}

							{#- Title outer -#}
							{%- block doc_title_outer -%}
								<title>

									{#- Title -#}
									{%- block doc_title doc.title|striptags|raw -%}

								</title>
							{%- endblock -%}

							{#- Metas -#}
							{%- block doc_meta -%}

								{#- Charset -#}
								{%- block doc_meta_charset -%}
									<meta charset="{{ doc.charset }}">
								{%- endblock -%}

							{%- endblock -%}

							{#- Preloads -#}
							{%- block doc_preload '' -%}

							{#- Stylesheets -#}
							{%- block doc_stylesheets '' -%}

							{#- Favicon -#}
							{%- block doc_favicon '' -%}

							{#- Scripts -#}
							{%- block doc_scripts '' -%}

						{%- endblock -%}

					</head>
				{%- endblock -%}

				{#- Body wrap -#}
				{%- block doc_body_outer -%}
					<body

						{#- Attributes -#}
						{%- with { 'attr_prefix': 'body_' } -%}
							{{- block('doc_attrs') -}}
						{%- endwith -%}

					>

						{#- Body -#}
						{%- block doc_body doc.body|raw -%}

					</body>
				{%- endblock -%}

			{%- endblock -%}

		</html>
	{%- endblock -%}

{%- endwith -%}
{%- endblock -%}
